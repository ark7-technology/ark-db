{"version":3,"sources":["mongoose/timestamp.ts"],"names":[],"mappings":";;;;;;;;;;;;AAAA,iCAAiC;AAYjC,IAAa,cAAc,GAA3B,MAAa,cAAe,SAAQ,KAAK,CAAC,KAAK;CAW9C,CAAA;AANC;IAJC,KAAK,CAAC,KAAK,CAAC;QACX,OAAO,EAAE,IAAI,CAAC,GAAG;QACjB,KAAK,EAAE,IAAI;KACZ,CAAC;8BACU,IAAI;iDAAC;AAKjB;IAHC,KAAK,CAAC,KAAK,CAAC;QACX,KAAK,EAAE,IAAI;KACZ,CAAC;8BACe,IAAI;sDAAC;AAVX,cAAc;IAR1B,KAAK,CAAC,GAAG,CAAC;QACT,IAAI,EAAE,MAAM;QACZ,EAAE,EAAE,uBAAuB;KAC5B,CAAC;IACD,KAAK,CAAC,GAAG,CAAC;QACT,IAAI,EAAE,kBAAkB;QACxB,EAAE,EAAE,yBAAyB;KAC9B,CAAC;GACW,cAAc,CAW1B;AAXY,wCAAc;AAa3B,SAAS,uBAAuB,CAAC,IAAgB;IAC/C,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;IACjC,IAAI,EAAE,CAAC;AACT,CAAC;AAED,SAAS,yBAAyB,CAAC,IAAgB;IACjD,IAAI,CAAC,MAAM,CACT,EAAE,EACF;QACE,IAAI,EAAE;YACJ,cAAc,EAAE,IAAI,CAAC,GAAG,EAAE;SAC3B;QACD,YAAY,EAAE;YACZ,SAAS,EAAE,IAAI,CAAC,GAAG,EAAE;SACtB;KACF,CACF,CAAC;IACF,IAAI,EAAE,CAAC;AACT,CAAC","file":"timestamp.js","sourcesContent":["import * as model from './model';\r\n\r\nexport type TimestampModelType = typeof TimestampModel;\r\n\r\n@model.Pre({\r\n  name: 'save',\r\n  fn: setLastUpdateTimeOnSave,\r\n})\r\n@model.Pre({\r\n  name: 'findOneAndUpdate',\r\n  fn: setLastUpdateTimeOnUpdate,\r\n})\r\nexport class TimestampModel extends model.Model {\r\n  @model.Field({\r\n    default: Date.now,\r\n    index: true,\r\n  })\r\n  createdAt?: Date;\r\n\r\n  @model.Field({\r\n    index: true,\r\n  })\r\n  lastUpdateTime?: Date;\r\n}\r\n\r\nfunction setLastUpdateTimeOnSave(next: () => void) {\r\n  this.lastUpdateTime = Date.now();\r\n  next();\r\n}\r\n\r\nfunction setLastUpdateTimeOnUpdate(next: () => void) {\r\n  this.update(\r\n    {},\r\n    {\r\n      $set: {\r\n        lastUpdateTime: Date.now(),\r\n      },\r\n      $setOnInsert: {\r\n        createdAt: Date.now(),\r\n      },\r\n    },\r\n  );\r\n  next();\r\n}\r\n"],"sourceRoot":"D:\\zyq\\ark-db/src"}