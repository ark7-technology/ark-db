{"version":3,"sources":["mongoose/model.ts"],"names":[],"mappings":"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","file":"model.js","sourcesContent":["import 'reflect-metadata';\r\n\r\nimport * as _ from 'underscore';\r\nimport debug from 'debug';\r\nimport {\r\n  Document as MDocument,\r\n  DocumentToObjectOptions,\r\n  Model as MModel,\r\n  Mongoose,\r\n  Query,\r\n  Schema,\r\n  SchemaOptions,\r\n  SchemaTypes,\r\n} from 'mongoose';\r\nimport { MongoError } from 'mongodb';\r\n\r\nimport { A7ModelType } from './a7-model';\r\nimport { AsObject, AsObjectPartial, ConvertModel } from './types';\r\nimport { SBaseMongooseConfig, sbaseMongooseConfig } from './model-config';\r\nimport { extendMetadata, pushMetadata } from './helpers';\r\n\r\nconst d = debug('sbase:model');\r\n\r\nexport type ModelType = typeof Model;\r\nexport type IModel<E extends DocumentModel> = MModel<E>;\r\n\r\nexport interface Document extends MDocument {\r\n  toJSON(options?: DocumentToObjectOptions): AsObject<this>;\r\n}\r\n\r\nexport interface Model {\r\n  toJSON(options?: DocumentToObjectOptions): AsObject<this>;\r\n}\r\n\r\n/**\r\n * Wrapped Model from mongoose.Model.\r\n */\r\nexport class Model {\r\n  public static modelize<T extends new (...args: any[]) => any>(\r\n    this: T,\r\n    o: AsObjectPartial<InstanceType<T>>,\r\n  ): InstanceType<T> {\r\n    const p = {\r\n      toJSON() {\r\n        return this;\r\n      },\r\n    };\r\n    Object.setPrototypeOf(o, p);\r\n    Object.setPrototypeOf(p, this.prototype);\r\n    return o as any;\r\n  }\r\n\r\n  public static Schema(schema: Schema): ModelType {\r\n    extendMetadata(SCHEMA_KEY, this.prototype, schema);\r\n    return this;\r\n  }\r\n\r\n  public static Config(config: SchemaOptions): ModelType {\r\n    extendMetadata(CONFIG_KEY, this.prototype, config);\r\n    return this;\r\n  }\r\n\r\n  public static Pre(pre: Pre): ModelType {\r\n    pushMetadata(PRE_KEY, this.prototype, pre);\r\n    return this;\r\n  }\r\n\r\n  public static Post(post: Post): ModelType {\r\n    pushMetadata(POST_KEY, this.prototype, post);\r\n    return this;\r\n  }\r\n\r\n  public static Virtual(virtual: Virtual): ModelType {\r\n    pushMetadata(VIRTUAL_KEY, this.prototype, virtual);\r\n    return this;\r\n  }\r\n\r\n  public static Plugin(plugin: Plugin): ModelType {\r\n    pushMetadata(PLUGIN_KEY, this.prototype, plugin);\r\n    return this;\r\n  }\r\n\r\n  public static Index(index: Index): ModelType {\r\n    pushMetadata(INDEX_KEY, this.prototype, index);\r\n    return this;\r\n  }\r\n\r\n  public static Mixin(model: ModelType): ModelType {\r\n    pushMetadata(MIXIN_KEY, this.prototype, model);\r\n    return this;\r\n  }\r\n\r\n  public static UpdateValidator(validate: UpdateValidator): ModelType {\r\n    pushMetadata(UPDATE_VALIDATOR_KEY, this.prototype, validate);\r\n    return this;\r\n  }\r\n\r\n  public static $mongooseOptions(\r\n    sbaseConfig?: SBaseMongooseConfig,\r\n    tenancy: string = 'default',\r\n  ): MongooseOptions {\r\n    if (this === Model) {\r\n      return null;\r\n    }\r\n\r\n    d('generate $mongooseOptions for %O', this.name);\r\n\r\n    let mongooseOptionsMap: MongooseOptionsMap = Reflect.getOwnMetadata(\r\n      MONGOOSE_OPTIONS_KEY,\r\n      this.prototype,\r\n    );\r\n\r\n    if (mongooseOptionsMap && mongooseOptionsMap[tenancy]) {\r\n      return mongooseOptionsMap[tenancy];\r\n    }\r\n\r\n    const mongooseOptions: MongooseOptions = {};\r\n\r\n    mongooseOptionsMap = {\r\n      [tenancy]: mongooseOptions,\r\n    };\r\n\r\n    Reflect.defineMetadata(\r\n      MONGOOSE_OPTIONS_KEY,\r\n      mongooseOptionsMap,\r\n      this.prototype,\r\n    );\r\n\r\n    const superClass: ModelType = (this as any).__proto__;\r\n\r\n    const superOptions: MongooseOptions =\r\n      superClass.$mongooseOptions(sbaseConfig, tenancy) || {};\r\n\r\n    const mixinModels: ModelType[] = _.union(\r\n      Reflect.getOwnMetadata(MIXIN_KEY, this.prototype) || [],\r\n    );\r\n    const mixinOptions = _.map(mixinModels, (model) =>\r\n      model.$mongooseOptions(sbaseConfig, tenancy),\r\n    );\r\n\r\n    const schemas = _.flatten([\r\n      _.map(mixinOptions, (opt) => opt.schema),\r\n      superOptions.schema,\r\n      Reflect.getOwnMetadata(SCHEMA_KEY, this.prototype),\r\n    ]);\r\n    mongooseOptions.schema = _.extend({}, ...schemas);\r\n\r\n    const configs = _.flatten([\r\n      _.map(mixinOptions, (opt) => opt.config),\r\n      superOptions.config,\r\n      Reflect.getOwnMetadata(CONFIG_KEY, this.prototype),\r\n    ]);\r\n    mongooseOptions.config = _.extend({}, ...configs);\r\n\r\n    mongooseOptions.pres = _.filter(\r\n      _.union(\r\n        _.flatten([\r\n          _.map(mixinOptions, (opt) => opt.pres),\r\n          superOptions.pres,\r\n          Reflect.getOwnMetadata(PRE_KEY, this.prototype),\r\n        ]),\r\n      ),\r\n      (x) => !!x,\r\n    );\r\n\r\n    mongooseOptions.posts = _.filter(\r\n      _.union(\r\n        _.flatten([\r\n          _.map(mixinOptions, (opt) => opt.posts),\r\n          superOptions.posts,\r\n          Reflect.getOwnMetadata(POST_KEY, this.prototype),\r\n        ]),\r\n      ),\r\n      (x) => !!x,\r\n    );\r\n\r\n    mongooseOptions.virtuals = _.filter(\r\n      _.union(\r\n        _.flatten([\r\n          _.map(mixinOptions, (opt) => opt.virtuals),\r\n          superOptions.virtuals,\r\n          Reflect.getOwnMetadata(VIRTUAL_KEY, this.prototype),\r\n        ]),\r\n      ),\r\n      (x) => !!x,\r\n    );\r\n\r\n    mongooseOptions.updateValidators = _.filter(\r\n      _.union(\r\n        _.flatten([\r\n          _.map(mixinOptions, (opt) => opt.updateValidators),\r\n          superOptions.updateValidators,\r\n          Reflect.getOwnMetadata(UPDATE_VALIDATOR_KEY, this.prototype),\r\n        ]),\r\n      ),\r\n      (x) => !!x,\r\n    );\r\n\r\n    mongooseOptions.plugins = _.sortBy(\r\n      _.filter(\r\n        _.union(\r\n          _.flatten([\r\n            _.map(mixinOptions, (opt) => opt.plugins),\r\n            superOptions.plugins,\r\n            Reflect.getOwnMetadata(PLUGIN_KEY, this.prototype),\r\n          ]),\r\n        ),\r\n        (x) => !!x,\r\n      ),\r\n      (plugin) => plugin.priority,\r\n    );\r\n\r\n    mongooseOptions.indexes = _.filter(\r\n      _.union(\r\n        _.flatten([\r\n          _.map(mixinOptions, (opt) => opt.indexes),\r\n          superOptions.indexes,\r\n          Reflect.getOwnMetadata(INDEX_KEY, this.prototype),\r\n        ]),\r\n      ),\r\n      (x) => !!x,\r\n    );\r\n\r\n    mongooseOptions.methods = _.filter(\r\n      _.union(\r\n        _.flatten([\r\n          _.map(mixinOptions, (opt) => opt.methods),\r\n          superOptions.methods,\r\n        ]),\r\n      ),\r\n      (x) => !!x,\r\n    );\r\n\r\n    mongooseOptions.statics = _.filter(\r\n      _.union(\r\n        _.flatten([\r\n          _.map(mixinOptions, (opt) => opt.statics),\r\n          superOptions.statics,\r\n        ]),\r\n      ),\r\n      (x) => !!x,\r\n    );\r\n\r\n    for (const name of Object.getOwnPropertyNames(this.prototype)) {\r\n      if (name === 'constructor') {\r\n        continue;\r\n      }\r\n\r\n      const descriptor = Object.getOwnPropertyDescriptor(this.prototype, name);\r\n\r\n      if (descriptor.value && _.isFunction(descriptor.value)) {\r\n        mongooseOptions.methods.push({ name, fn: descriptor.value });\r\n      }\r\n\r\n      if (descriptor.get || descriptor.set) {\r\n        mongooseOptions.virtuals.push({\r\n          name,\r\n          get: descriptor.get,\r\n          set: descriptor.set,\r\n        });\r\n      }\r\n    }\r\n\r\n    for (const name of Object.getOwnPropertyNames(this)) {\r\n      const descriptor = Object.getOwnPropertyDescriptor(this, name);\r\n\r\n      if (STATIC_FILTER_NAMES.indexOf(name) >= 0) {\r\n        continue;\r\n      }\r\n\r\n      if (descriptor.value) {\r\n        mongooseOptions.statics.push({ name, fn: descriptor.value });\r\n      }\r\n    }\r\n\r\n    const collection =\r\n      sbaseConfig != null && mongooseOptions.config.collection\r\n        ? _.chain([\r\n            tenancy === 'default'\r\n              ? sbaseConfig.multiTenancy.defaultCollectionNamespace\r\n              : tenancy,\r\n            mongooseOptions.config.collection,\r\n          ])\r\n            .filter((x) => !!x)\r\n            .join('.')\r\n            .value()\r\n        : mongooseOptions.config.collection;\r\n\r\n    const mongooseSchema = new Schema(\r\n      mongooseOptions.schema,\r\n      _.extend(_.clone(mongooseOptions.config), { collection }),\r\n    );\r\n\r\n    (mongooseSchema as any).parentSchema = superOptions.mongooseSchema;\r\n\r\n    for (const pre of mongooseOptions.pres) {\r\n      d(\r\n        'create pre for %O with name %O and options %O',\r\n        this.name,\r\n        pre.name,\r\n        pre,\r\n      );\r\n      pre.parallel = pre.parallel || false;\r\n      mongooseSchema.pre(pre.name, pre.parallel, pre.fn, pre.errorCb);\r\n    }\r\n\r\n    for (const post of mongooseOptions.posts) {\r\n      d(\r\n        'create post for %O with name %O and options %O',\r\n        this.name,\r\n        post.name,\r\n        post,\r\n      );\r\n      (mongooseSchema as any).post(post.name, post.fn);\r\n    }\r\n\r\n    for (const virtual of mongooseOptions.virtuals) {\r\n      d(\r\n        'create virtual for %O with name %O and options %O',\r\n        this.name,\r\n        virtual.name,\r\n        virtual.options,\r\n      );\r\n      let v = mongooseSchema.virtual(virtual.name, virtual.options);\r\n      if (virtual.get) {\r\n        v = v.get(virtual.get);\r\n      }\r\n      if (virtual.set) {\r\n        v = v.set(virtual.set);\r\n      }\r\n    }\r\n\r\n    for (const method of mongooseOptions.methods) {\r\n      d(\r\n        'create method for %O with name %O and function %O',\r\n        this.name,\r\n        method.name,\r\n        method.fn,\r\n      );\r\n      mongooseSchema.methods[method.name] = method.fn;\r\n    }\r\n\r\n    for (const method of mongooseOptions.statics) {\r\n      mongooseSchema.statics[method.name] = method.fn;\r\n    }\r\n\r\n    for (const plugin of mongooseOptions.plugins) {\r\n      const options = _.extend({}, mongooseOptions.config, plugin.options);\r\n      mongooseSchema.plugin(plugin.fn, options);\r\n    }\r\n\r\n    for (const index of mongooseOptions.indexes) {\r\n      d(\r\n        'create index for %O with fields %O and options %O',\r\n        this.name,\r\n        index.fields,\r\n        index.options,\r\n      );\r\n      mongooseSchema.index(index.fields, index.options);\r\n    }\r\n\r\n    for (const validate of mongooseOptions.updateValidators) {\r\n      mongooseSchema\r\n        .path(validate.path)\r\n        .validate(\r\n          combineValidator(validate.fn),\r\n          validate.errorMsg,\r\n          validate.type,\r\n        );\r\n    }\r\n\r\n    mongooseOptions.mongooseSchema = mongooseSchema;\r\n    return mongooseOptions;\r\n  }\r\n\r\n  public static $register<T extends ModelType>(\r\n    this: T,\r\n    mongooseInstance?: Mongoose,\r\n  ): ConvertModel<InstanceType<T> & Document, InstanceType<T>> & T {\r\n    return registerMultiTenancy(this, mongooseInstance) as any;\r\n  }\r\n\r\n  public static $registerA7Model<T extends ModelType>(\r\n    this: T,\r\n    mongooseInstance?: Mongoose,\r\n  ): ConvertModel<InstanceType<T> & Document, InstanceType<T>> &\r\n    T &\r\n    A7ModelType {\r\n    return registerMultiTenancy(this, mongooseInstance) as any;\r\n  }\r\n}\r\n\r\nconst mongooseInstanceMap: {\r\n  [tenancy: string]: Mongoose;\r\n} = {};\r\n\r\nexport const lazyFns: string[] = [];\r\n\r\nexport const shareFns = ['on'];\r\n\r\nfunction registerMultiTenancy<T extends ModelType>(\r\n  model: T,\r\n  mongooseInstance?: Mongoose,\r\n): MModel<Document> & T {\r\n  if (!mongooseInstance) {\r\n    mongooseInstance = require('mongoose');\r\n    (mongooseInstance as any).sbaseConfig = sbaseMongooseConfig;\r\n  }\r\n\r\n  const sbaseConfig: SBaseMongooseConfig = (mongooseInstance as any)\r\n    .sbaseConfig;\r\n\r\n  if (!sbaseConfig.multiTenancy.enabled) {\r\n    const m = mongooseInstance.model(\r\n      model.name,\r\n      model.$mongooseOptions().mongooseSchema,\r\n    ) as any;\r\n\r\n    m.sbaseConfig = sbaseConfig;\r\n\r\n    return m;\r\n  }\r\n\r\n  const tenants = ['default'].concat(sbaseConfig.multiTenancy.tenants);\r\n  const tenantMap: {\r\n    [key: string]: MModel<Document> & T;\r\n  } = {};\r\n\r\n  for (const tenancy of tenants) {\r\n    let mi = mongooseInstanceMap[tenancy];\r\n\r\n    if (mi == null) {\r\n      mi = new Mongoose();\r\n      mi.connect(\r\n        sbaseConfig.multiTenancy.uris,\r\n        sbaseConfig.multiTenancy.options,\r\n        (err) => {\r\n          sbaseConfig.multiTenancy.onError(err, tenancy);\r\n        },\r\n      );\r\n      sbaseConfig.multiTenancy.onMongooseInstanceCreated(mi, tenancy);\r\n      mongooseInstanceMap[tenancy] = mi;\r\n    }\r\n\r\n    const m = mi.model(\r\n      model.name,\r\n      model.$mongooseOptions(sbaseConfig, tenancy).mongooseSchema,\r\n    ) as any;\r\n\r\n    m.sbaseConfig = sbaseConfig;\r\n\r\n    tenantMap[tenancy] = m;\r\n  }\r\n\r\n  const proxy: any = new Proxy<MModel<Document> & T>({} as any, {\r\n    get: (_obj: {}, prop: string) => {\r\n      if (prop === '$tenantMap') {\r\n        return tenantMap;\r\n      }\r\n\r\n      if (lazyFns.indexOf(prop) >= 0) {\r\n        const ret = function () {\r\n          const t = sbaseConfig.multiTenancy.tenancyFn(prop);\r\n          const m1: any = tenantMap[t];\r\n          const actualFn = m1[prop];\r\n\r\n          return actualFn.apply(this, arguments);\r\n        };\r\n        return ret;\r\n      }\r\n\r\n      if (shareFns.indexOf(prop) >= 0) {\r\n        const ret = (...args: any[]) => {\r\n          return _.map(tenants, (t) => {\r\n            const m2: any = tenantMap[t];\r\n            return m2[prop].apply(m2, args);\r\n          });\r\n        };\r\n        return ret;\r\n      }\r\n\r\n      const tenancy = sbaseConfig.multiTenancy.tenancyFn(prop);\r\n      const m: any = tenantMap[tenancy];\r\n      m._proxy = proxy;\r\n\r\n      if (prop === '$modelClass') {\r\n        return m;\r\n      }\r\n\r\n      const res = m[prop];\r\n      return _.isFunction(res) ? res.bind(m) : res;\r\n    },\r\n    set: (_obj: {}, prop: string, value: any) => {\r\n      const tenancy = sbaseConfig.multiTenancy.tenancyFn(prop);\r\n      const m: any = tenantMap[tenancy];\r\n      m[prop] = value;\r\n      return true;\r\n    },\r\n  });\r\n\r\n  return proxy;\r\n}\r\n\r\nexport interface DocumentModel extends Document {}\r\n\r\nexport class DocumentModel extends Model {\r\n  public static cast<D extends DocumentModel>(): IModel<D> {\r\n    return (this as any)._proxy || this;\r\n  }\r\n}\r\n\r\nconst SCHEMA_KEY = Symbol('sbase:schema');\r\nconst CONFIG_KEY = Symbol('sbase:config');\r\nconst PRE_KEY = Symbol('sbase:pre');\r\nconst POST_KEY = Symbol('sbase:post');\r\nconst VIRTUAL_KEY = Symbol('sbase:virtual');\r\nconst PLUGIN_KEY = Symbol('sbase:plugin');\r\nconst INDEX_KEY = Symbol('sbase:index');\r\nconst UPDATE_VALIDATOR_KEY = Symbol('sbase:updateValidator');\r\nconst MIXIN_KEY = Symbol('sbase:mixin');\r\nconst MONGOOSE_OPTIONS_KEY = Symbol('sbase:mongooseOptions');\r\n\r\nexport function Enum(e: any, schema: any = {}) {\r\n  return Field(\r\n    _.extend({}, schema, {\r\n      type: String,\r\n      enum: Object.values(e).concat([null]),\r\n    }),\r\n  );\r\n}\r\n\r\nexport function DBRef(ref: string, schema: any = {}) {\r\n  return Field(\r\n    _.extend({}, schema, {\r\n      type: SchemaTypes.ObjectId,\r\n      ref,\r\n    }),\r\n  );\r\n}\r\n\r\nexport function DBRefArray(ref: string, schema: any = {}) {\r\n  return Field(\r\n    _.extend({}, schema, {\r\n      type: [\r\n        {\r\n          type: SchemaTypes.ObjectId,\r\n          ref,\r\n        },\r\n      ],\r\n    }),\r\n  );\r\n}\r\n\r\nexport function ArrayField(type: any, schema: any = {}) {\r\n  return Field(\r\n    _.extend({}, schema, {\r\n      type: [type],\r\n      default: [],\r\n    }),\r\n  );\r\n}\r\n\r\nexport function Required(\r\n  opt: boolean | (() => boolean | Promise<boolean>) = true,\r\n  schema: any = {},\r\n) {\r\n  return Field(\r\n    _.extend({}, schema, {\r\n      required: _.isFunction(opt) ? combineValidator(opt) : opt,\r\n    }),\r\n  );\r\n}\r\n\r\nexport function IndexField(schema: any = {}) {\r\n  return Field(\r\n    _.extend({}, schema, {\r\n      index: true,\r\n    }),\r\n  );\r\n}\r\n\r\nexport function Unique(schema: any = {}) {\r\n  return Field(\r\n    _.extend({}, schema, {\r\n      index: true,\r\n      unique: true,\r\n    }),\r\n  );\r\n}\r\n\r\nexport function Default(defaultValue: any, schema: any = {}) {\r\n  return Field(\r\n    _.extend({}, schema, {\r\n      default: defaultValue,\r\n    }),\r\n  );\r\n}\r\n\r\nexport function MapField(type: any, schema: any = {}) {\r\n  return Field(\r\n    _.extend({}, schema, {\r\n      type: Map,\r\n      of: type,\r\n    }),\r\n  );\r\n}\r\n\r\nexport function Optional(schema: any = {}) {\r\n  return Field(schema);\r\n}\r\n\r\nexport function Validate(validator: Validator, schema: any = {}) {\r\n  return Field(\r\n    _.extend({}, schema, {\r\n      validate: {\r\n        validator: combineValidator(validator.validator),\r\n        message: validator.message,\r\n      },\r\n    }),\r\n  );\r\n}\r\n\r\nexport function Field(schema: any = {}): PropertyDecorator {\r\n  function mapModelSchema(o: any): any {\r\n    if (_.isArray(o)) {\r\n      return _.map(o, (x) => mapModelSchema(x));\r\n    } else if (_.isFunction(o)) {\r\n      if (o.prototype instanceof Model) {\r\n        const func = Object.getOwnPropertyDescriptor(\r\n          o.__proto__,\r\n          '$mongooseOptions',\r\n        );\r\n        return func.value.call(o).mongooseSchema;\r\n      } else {\r\n        return o;\r\n      }\r\n    } else if (_.isObject(o) && o.__proto__.constructor.name === 'Object') {\r\n      return _.mapObject(o, (x) => mapModelSchema(x));\r\n    } else {\r\n      return o;\r\n    }\r\n  }\r\n\r\n  return (target: any, propertyName: string) => {\r\n    const schemas = Reflect.getOwnMetadata(SCHEMA_KEY, target) || {};\r\n    const existing = schemas[propertyName];\r\n\r\n    if (schema.type == null && existing == null) {\r\n      const type = Reflect.getMetadata('design:type', target, propertyName);\r\n      schema.type = type;\r\n    }\r\n\r\n    if (\r\n      _.isUndefined(schema.default) &&\r\n      schema.type &&\r\n      schema.type.prototype instanceof Model\r\n    ) {\r\n      schema.default = () => ({});\r\n    }\r\n\r\n    schemas[propertyName] = _.extend({}, existing, mapModelSchema(schema));\r\n    Reflect.defineMetadata(SCHEMA_KEY, schemas, target);\r\n  };\r\n}\r\n\r\nexport function Mixin(model: ModelType) {\r\n  return <T extends new (...args: any[]) => {}>(constructor: T) => {\r\n    const models: ModelType[] =\r\n      Reflect.getOwnMetadata(MIXIN_KEY, constructor.prototype) || [];\r\n\r\n    models.push(model);\r\n    Reflect.defineMetadata(MIXIN_KEY, models, constructor.prototype);\r\n  };\r\n}\r\n\r\nexport function Config(config: SchemaOptions) {\r\n  return <T extends new (...args: any[]) => {}>(constructor: T) => {\r\n    const configs: SchemaOptions =\r\n      Reflect.getOwnMetadata(CONFIG_KEY, constructor.prototype) || {};\r\n\r\n    _.extend(configs, config);\r\n    Reflect.defineMetadata(CONFIG_KEY, configs, constructor.prototype);\r\n  };\r\n}\r\n\r\nexport function Plugin(plugin: Plugin) {\r\n  return <T extends new (...args: any[]) => {}>(constructor: T) => {\r\n    const plugins: Plugin[] =\r\n      Reflect.getOwnMetadata(PLUGIN_KEY, constructor.prototype) || [];\r\n\r\n    plugins.push(plugin);\r\n    Reflect.defineMetadata(PLUGIN_KEY, plugins, constructor.prototype);\r\n  };\r\n}\r\n\r\nexport function Pre(pre: Pre) {\r\n  return <T extends new (...args: any[]) => {}>(constructor: T) => {\r\n    pushMetadata(PRE_KEY, constructor.prototype, pre);\r\n  };\r\n}\r\n\r\nexport function Pres(names: string[], pre: PPre) {\r\n  return <T extends new (...args: any[]) => {}>(constructor: T) => {\r\n    const pres = _.map(names, (name) => _.extend({ name }, pre));\r\n    pushMetadata(PRE_KEY, constructor.prototype, ...pres);\r\n  };\r\n}\r\n\r\nexport function Virtual(options: VirtualOptions) {\r\n  return (target: any, propertyName: string) => {\r\n    const virtuals: Virtual[] =\r\n      Reflect.getOwnMetadata(VIRTUAL_KEY, target) || [];\r\n    virtuals.push({\r\n      name: propertyName,\r\n      options,\r\n    });\r\n    Reflect.defineMetadata(VIRTUAL_KEY, virtuals, target);\r\n  };\r\n}\r\n\r\nexport function Post(post: Post) {\r\n  return <T extends new (...args: any[]) => {}>(constructor: T) => {\r\n    const posts: Post[] =\r\n      Reflect.getOwnMetadata(POST_KEY, constructor.prototype) || [];\r\n    posts.push(post);\r\n    Reflect.defineMetadata(POST_KEY, posts, constructor.prototype);\r\n  };\r\n}\r\n\r\nexport function Posts(names: string[], post: PPost) {\r\n  return <T extends new (...args: any[]) => {}>(constructor: T) => {\r\n    const posts: Post[] =\r\n      Reflect.getOwnMetadata(POST_KEY, constructor.prototype) || [];\r\n    for (const name of names) {\r\n      posts.push(_.extend({ name }, post));\r\n    }\r\n    Reflect.defineMetadata(POST_KEY, posts, constructor.prototype);\r\n  };\r\n}\r\n\r\nexport function Index(index: Index) {\r\n  return <T extends new (...args: any[]) => {}>(constructor: T) => {\r\n    const indexes: Index[] =\r\n      Reflect.getOwnMetadata(INDEX_KEY, constructor.prototype) || [];\r\n    indexes.push(index);\r\n    Reflect.defineMetadata(INDEX_KEY, indexes, constructor.prototype);\r\n  };\r\n}\r\n\r\nexport function UpdateValidator(validate: UpdateValidator) {\r\n  return <T extends new (...args: any[]) => {}>(constructor: T) => {\r\n    const validates: UpdateValidator[] =\r\n      Reflect.getOwnMetadata(UPDATE_VALIDATOR_KEY, constructor.prototype) || [];\r\n    validates.push(validate);\r\n    Reflect.defineMetadata(\r\n      UPDATE_VALIDATOR_KEY,\r\n      validates,\r\n      constructor.prototype,\r\n    );\r\n  };\r\n}\r\n\r\n/**\r\n * Mongoose options for current model.\r\n */\r\nexport interface MongooseOptions {\r\n  config?: SchemaOptions;\r\n  schema?: {};\r\n  mongooseSchema?: Schema;\r\n  pres?: Pre[];\r\n  posts?: Post[];\r\n  virtuals?: Virtual[];\r\n  methods?: Method[];\r\n  statics?: Method[];\r\n  plugins?: Plugin[];\r\n  indexes?: Index[];\r\n  updateValidators?: UpdateValidator[];\r\n}\r\n\r\nexport interface MongooseOptionsMap {\r\n  [key: string]: MongooseOptions;\r\n}\r\n\r\nexport interface Pre {\r\n  name: string;\r\n  fn: (next: (err?: NativeError) => void) => void;\r\n  parallel?: boolean;\r\n  errorCb?: (err: Error) => void;\r\n}\r\n\r\nexport interface PPre {\r\n  fn: (next: (err?: NativeError) => void) => void;\r\n  parallel?: boolean;\r\n  errorCb?: (err: Error) => void;\r\n}\r\n\r\nexport interface Post {\r\n  name: string;\r\n  fn: PostFn1 | PostFn2;\r\n}\r\n\r\nexport interface PPost {\r\n  fn: PostFn1 | PostFn2;\r\n}\r\n\r\nexport type PostFn1 = (doc: object, next: (err?: NativeError) => void) => void;\r\nexport type PostFn2 = (\r\n  error: MongoError,\r\n  doc: object,\r\n  next: (err?: NativeError) => void,\r\n) => void;\r\n\r\nexport interface Virtual {\r\n  name: string;\r\n  get?: () => any;\r\n  set?: (val?: any) => void;\r\n  options?: VirtualOptions;\r\n}\r\n\r\nexport interface Method {\r\n  name: string;\r\n  fn: () => void;\r\n}\r\n\r\nexport interface Plugin {\r\n  fn: (schema: Schema, options?: object) => void;\r\n  options?: object;\r\n  priority?: number;\r\n}\r\n\r\nexport interface Index {\r\n  fields: object;\r\n  options?: {\r\n    expires?: string;\r\n    [other: string]: any;\r\n  };\r\n}\r\n\r\nexport interface Validator {\r\n  validator: (v: any) => any;\r\n  message: string | ((props: { value: any }) => string);\r\n}\r\n\r\nexport interface UpdateValidator {\r\n  path: string;\r\n  fn: (val?: any) => boolean;\r\n  errorMsg?: string;\r\n  type?: string;\r\n}\r\n\r\nexport interface VirtualOptions {\r\n  ref: string;\r\n  localField: string;\r\n  foreignField: string;\r\n  justOne?: boolean;\r\n  options?: any;\r\n  count?: boolean;\r\n  match?: object;\r\n}\r\n\r\nexport class NativeError extends global.Error {}\r\n\r\nexport const preQueries = [\r\n  'find',\r\n  'findOne',\r\n  'count',\r\n  'findOneAndUpdate',\r\n  'findOneAndRemove',\r\n  'update',\r\n];\r\n\r\nconst STATIC_FILTER_NAMES = ['name', 'length', 'prototype'];\r\n\r\nexport function combineValidator<T>(\r\n  fn: (this: T, _v: any) => boolean | Promise<boolean>,\r\n): () => boolean | Promise<boolean> {\r\n  return function (this: T | Query<T>) {\r\n    if (this instanceof Query) {\r\n      return fn.apply(this.getUpdate().$set, arguments);\r\n    } else {\r\n      return fn.apply(this, arguments);\r\n    }\r\n  };\r\n}\r\n"],"sourceRoot":"D:\\zyq\\ark-db/src"}